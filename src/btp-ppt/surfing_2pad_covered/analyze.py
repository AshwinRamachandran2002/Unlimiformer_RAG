dicti={1: {}, 2: {}, 3: {}, 4: {2: [(2, 19, 2145, 'Fact', ':', 'Sav', 'ann', 'ah')]}, 5: {}, 6: {}, 7: {}, 8: {}, 9: {34: [(2, 10, 1701, 'magic', 'tr', 'icks', ',', 'Fact'), (3, 10, 1701, 'magic', 'tr', 'icks', ',', 'Fact'), (3, 36, 1210, 'ope', 'is', 'Act', 'ing', ',')], 33: [(3, 13, 2035, 'up', 'comedy', ',', 'Fact', ':'), (2, 46, 1241, 'Sing', 'ing', 'k', 'ara', 'oke'), (2, 45, 2582, 'Sc', 'rap', 'book', 'ing', ','), (3, 19, 1183, 'Arch', 'ery', ',', 'Fact', ':'), (3, 43, 1241, 'Sing', 'ing', 'k', 'ara', 'oke'), (3, 42, 2582, 'Sc', 'rap', 'book', 'ing', ','), (2, 20, 2582, 'Sc', 'rap', 'book', 'ing', ',')]}, 10: {13: [(3, 0, 945, 'Play', 'ing', 'basketball', ',', 'Fact'), (2, 0, 945, 'Play', 'ing', 'basketball', ',', 'Fact')], 18: [(3, 41, 109, 'is', 'Dan', 'cing', ',', 'Fact')]}, 11: {}, 12: {}, 13: {21: [(2, 19, 2491, 'Tai', 'Chi', ',', 'Fact', ':'), (2, 21, 1240, 'is', 'Sing', 'ing', 'k', 'ara'), (2, 25, 2062, 'Kar', 'ate', ',', 'Fact', ':'), (2, 48, 2062, 'Kar', 'ate', ',', 'Fact', ':')], 23: [(3, 2, 916, 'ing', 'a', 'puzz', 'le', ','), (3, 23, 2431, 'Adam', 'is', 'Zum', 'ba', ','), (3, 40, 2489, 'Eli', 'is', 'Tai', 'Chi', ','), (3, 42, 1037, 'Ice', 'sk', 'ating', ',', 'Fact')], 26: [(3, 13, 1211, 'is', 'Act', 'ing', ',', 'Fact'), (3, 36, 1211, 'is', 'Act', 'ing', ',', 'Fact')], 24: [(3, 19, 1354, 'Leo', 'is', 'Pot', 'tery', ',')], 30: [(3, 24, 909, 'ham', ',', 'Fact', ':', 'Victoria')]}, 14: {}, 15: {2: [(3, 6, 801, 'se', 'back', 'r', 'iding', ','), (3, 23, 2433, 'Zum', 'ba', ',', 'Fact', ':'), (3, 40, 2433, 'Zum', 'ba', ',', 'Fact', ':')]}, 16: {21: [(3, 40, 1003, 'is', 'B', 'aking', ',', 'Fact'), (2, 22, 404, 'Fact', ':', 'Benjamin', 'is', 'Watch'), (2, 48, 404, 'Fact', ':', 'Benjamin', 'is', 'Watch'), (3, 20, 1355, 'is', 'Pot', 'tery', ',', 'Fact')], 30: [(2, 25, 2275, 'ik', 'ing', ',', 'Fact', ':')], 33: [(3, 13, 916, 'ing', 'a', 'puzz', 'le', ','), (2, 46, 1241, 'Sing', 'ing', 'k', 'ara', 'oke'), (3, 23, 407, 'is', 'Watch', 'ing', 'a', 'movie')]}, 17: {16: [(3, 23, 2209, 'rey', 'is', 'Long', 'board', 'ing')]}, 18: {}, 19: {10: [(2, 49, 191, 'Fact', ':', 'Charlotte', 'is', 'Cy')], 3: [(3, 23, 2120, 'is', 'F', 'encing', ',', 'Fact'), (3, 40, 2120, 'is', 'F', 'encing', ',', 'Fact')], 0: [(3, 40, 2304, 'ag', 'l', 'iding', ',', 'Fact')]}, 20: {18: [(3, 18, 344, 'Fact', ':', 'James', 'is', 'Y'), (2, 20, 2432, 'is', 'Zum', 'ba', ',', 'Fact')], 25: [(2, 48, 1352, 'Fact', ':', 'Leo', 'is', 'Pot'), (3, 15, 1352, 'Fact', ':', 'Leo', 'is', 'Pot'), (2, 25, 1352, 'Fact', ':', 'Leo', 'is', 'Pot'), (2, 45, 1352, 'Fact', ':', 'Leo', 'is', 'Pot'), (3, 18, 1352, 'Fact', ':', 'Leo', 'is', 'Pot'), (2, 36, 824, 'Fact', ':', 'Michael', 'is', 'Phot')], 23: [(3, 15, 344, 'Fact', ':', 'James', 'is', 'Y'), (3, 18, 344, 'Fact', ':', 'James', 'is', 'Y'), (3, 19, 344, 'Fact', ':', 'James', 'is', 'Y'), (3, 35, 1880, 'vi', 'is', 'Home', 'bre', 'wing'), (3, 40, 1880, 'vi', 'is', 'Home', 'bre', 'wing')]}, 21: {15: [(3, 18, 162, 'Fact', ':', 'Mason', 'is', 'S'), (3, 7, 162, 'Fact', ':', 'Mason', 'is', 'S'), (3, 42, 2243, 'lack', 'lin', 'ing', ',', 'Fact'), (2, 45, 162, 'Fact', ':', 'Mason', 'is', 'S'), (2, 36, 162, 'Fact', ':', 'Mason', 'is', 'S'), (3, 15, 162, 'Fact', ':', 'Mason', 'is', 'S'), (2, 48, 162, 'Fact', ':', 'Mason', 'is', 'S'), (2, 7, 162, 'Fact', ':', 'Mason', 'is', 'S')], 25: [(3, 3, 801, 'se', 'back', 'r', 'iding', ','), (3, 5, 801, 'se', 'back', 'r', 'iding', ','), (3, 9, 822, 'Chicago', ',', 'Fact', ':', 'Michael')], 4: [(3, 34, 802, 'back', 'r', 'iding', ',', 'Fact')]}, 22: {33: [(3, 40, 1880, 'vi', 'is', 'Home', 'bre', 'wing')]}, 23: {}, 24: {}, 25: {}, 26: {30: [(2, 25, 2266, 'Fact', ':', 'Brook', 'lyn', 'is'), (2, 36, 1206, 'Fact', ':', 'Pen', 'el', 'ope'), (2, 45, 2266, 'Fact', ':', 'Brook', 'lyn', 'is'), (2, 48, 2266, 'Fact', ':', 'Brook', 'lyn', 'is')]}, 27: {18: [(3, 8, 2000, 'Fact', ':', 'Haz', 'el', 'is'), (3, 10, 2000, 'Fact', ':', 'Haz', 'el', 'is'), (3, 15, 2000, 'Fact', ':', 'Haz', 'el', 'is'), (3, 17, 2000, 'Fact', ':', 'Haz', 'el', 'is'), (3, 18, 2000, 'Fact', ':', 'Haz', 'el', 'is')]}, 28: {24: [(3, 40, 1821, 'Isaac', 'is', 'Do', 'ing', 'make'), (3, 42, 2490, 'is', 'Tai', 'Chi', ',', 'Fact')]}, 29: {}, 30: {24: [(3, 5, 432, 'har', ',', 'Fact', ':', 'Ab'), (2, 48, 851, 'Fact', ':', 'Sof', 'ia', 'is'), (2, 36, 1846, 'Fact', ':', 'Natal', 'ie', 'is'), (2, 25, 2365, 'Fact', ':', 'Anthony', 'is', 'S'), (2, 5, 432, 'har', ',', 'Fact', ':', 'Ab'), (3, 25, 1352, 'Fact', ':', 'Leo', 'is', 'Pot')]}, 31: {}, 32: {}, 33: {}, 34: {}, 35: {}, 36: {2: [(2, 8, 1662, 'Fact', ':', 'Add', 'ison', 'is'), (2, 10, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 11, 2145, 'Fact', ':', 'Sav', 'ann', 'ah'), (2, 13, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 15, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 17, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 18, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 21, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 22, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 25, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 27, 2206, 'Fact', ':', 'Aud', 'rey', 'is'), (2, 28, 1662, 'Fact', ':', 'Add', 'ison', 'is'), (2, 29, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 31, 1662, 'Fact', ':', 'Add', 'ison', 'is'), (2, 36, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 43, 250, 'Fact', ':', 'Am', 'elia', 'is'), (2, 47, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 48, 52, 'Fact', ':', 'Oliver', 'is', 'Reading'), (2, 50, 52, 'Fact', ':', 'Oliver', 'is', 'Reading')]}, 37: {4: [(3, 41, 2302, 'is', 'Par', 'ag', 'l', 'iding'), (3, 42, 2369, 'S', 'als', 'a', 'dan', 'cing')]}, 38: {}, 39: {}}


doc = 2
# doc = 21

import json
with open("../dataset/token_counts_pad.json", "r") as f:
    token_counts = json.loads(f.read())["fact_lengths"][1:]

fact_len = []
for i in range(len(token_counts)):
    fact_len.append(sum(token_counts[:i]))

collection = []
for layer in dicti.keys():
    for head in range(40):
        if head in dicti[layer]:
            errs = dicti[layer][head]
            for error in errs:
                if doc == error[0]:
                    collection.append((error[1], layer, head, error[2], error[3], error[4], error[5], error[6]))
                    # print("layer", layer, "head", head, error)

import numpy as np
sorted_collection = sorted(collection, key=lambda tup: (tup[0], tup[1], tup[2]))
number_stats = {}
for error in sorted_collection:
    bool_index = error[3] < np.array(fact_len)
    bool_index = np.where(bool_index == 1)[0][0]
    if bool_index not in number_stats:
        number_stats[bool_index] = 0
    number_stats[bool_index] += 1
    # print("POS", error[0], "layer", error[1], "head", error[2], bool_index)
    print("POS", error[0], "layer", error[1], "head", error[2], error[3], error[4], error[5], error[6], error[7])
    # pass
# remove 19, 33
# remove 10, 25
# remove 11, 37
rank = []
for layer in dicti.keys():
    for head in range(40):
        if head in dicti[layer]:
            rank.append((layer, head, len(dicti[layer][head])))
sorted_rank = sorted(rank, key=lambda tup: -tup[2])
sorted_stat = sorted(number_stats.items(), key=lambda tup: -tup[1])
# print(sorted_rank)
print(sorted_stat)

config_layer_head = {1: [35], 2: [], 3: [], 4: [16, 2, 29], 5: [32, 4], 6: [36, 31], 7: [], 8: [33, 4], 9: [33, 34], 10: [18, 13], 11: [37, 7], 12: [28, 21], 13: [14, 21, 23, 24, 26, 30], 14: [0, 2, 21, 26], 15: [2], 16: [33, 2, 12, 20, 21, 25, 30, 31], 17: [33, 2, 3, 8, 11, 16, 28, 30], 18: [16, 35, 30, 14], 19: [0, 33, 1, 3, 4, 5, 10, 14, 16, 27, 29], 20: [34, 36, 18, 22, 23, 25], 21: [4, 7, 14, 15, 19, 25], 22: [33], 23: [1, 13, 38], 24: [], 25: [30], 26: [30], 27: [33, 18], 28: [24], 29: [], 30: [24], 31: [], 32: [], 33: [11], 34: [], 35: [], 36: [2], 37: [4], 38: [], 39: []}
                    
new_config = config_layer_head
for rank in sorted_rank:
    if rank[2] >=100:
        config_layer_head[rank[0]].remove(rank[1])

# print(config_layer_head)